#!/bin/bash

# NOTE: To run this, you must give it executable permissions using the following command
# chmod +x copyDelete.sh

# Create delay between 10 and 30 seconds
randomDelay() {
    echo $((RANDOM % 21 + 10))
}

# Return a random file
randomfile() {
    files=(./resources/copyDeleteDirectory/*)
    if [ ${#files[@]} -eq 0 ]; then
        echo ""
    else
        echo ${files[RANDOM % ${#files[@]}]}
    fi
}

# Infinite loop
while true; do
    # Get a random delay and sleep for that duration
    delay=$(randomDelay)
    echo "Sleeping for $delay seconds"
    sleep $delay
    
    # Get a random file from the directory
    currentFile=$(randomfile)
    if [ -z "$currentFile" ] || [ ! -f "$currentFile" ]; then
        echo "Error: No files found in the directory."
        exit 1
    fi

    # Copy the file with the Unix time as the new name
    timestamp=$(date +%s)
    cp "$currentFile" "./resources/copyDeleteDirectory/$timestamp"
    if [ $? -eq 0 ]; then
        echo "Copied $currentFile to ./resources/copyDeleteDirectory/$timestamp"
    else
        echo "Failed to copy $currentFile"
        continue
    fi
    
    # Delete the original file
    rm "$currentFile"
    if [ $? -eq 0 ]; then
        echo "Deleted $currentFile"
    else
        echo "Failed to delete $currentFile"
    fi
    
    echo "----------------------------------------"
done
